<!DOCTYPE html><html><head><title>Testing private functions in Angular</title><link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><link rel="stylesheet" href="/css/materialize.min.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/prism.css"><script src="https://code.jquery.com/jquery-3.1.1.min.js" type="text/javascript" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script><script src="/js/prism.js" type="text/javascript"></script><script src="/js/materialize.min.js" type="text/javascript"></script><script src="/js/main.js" type="text/javascript"></script></head><body class="main-color lighten-4"><div id="fb-root"></div><script>(function(d, s, id) {
var js, fjs = d.getElementsByTagName(s)[0];
if (d.getElementById(id)) return;
js = d.createElement(s); js.id = id;
js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.8";
fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script><nav role="navigation"><div class="nav-wrapper main-color lighten-1"><div class="container"><a id="logo-container" href="/" class="brand-logo">Vamshi Krishna Pothuka</a><ul class="right hide-on-med-and-down"><li class="active"><a href="/blog">Blog</a></li><li><a href="/book">Book</a></li></ul></div></div></nav><div class="section back main-color"></div><div class="section blog"><div class="container"><nav class="z-depth-0 main-color"><div class="nav-wrapper"><div class="col s12"><a href="/" class="breadcrumb">home</a><a href="/blog" class="breadcrumb">blog</a><a href="#!" class="breadcrumb">Testing private functions in Angular</a></div></div></nav><div class="card z-depth-2"><!--removed .flow-text--><div class="card-content flow-text"><span class="posted grey-text">05 June 2016</span><!--.fb-like(data-share="true"
data-width="450"
data-show-faces="true")--><h2>Testing private functions in Angular</h2><blockquote>
<p>This is a workaround. There is no framework support.</p>
</blockquote>
<p>tl;dr : <a href="https://plnkr.co/edit/EGOOTDBUSuPltHDvEEKx?p=preview">plnkr.co/edit/EGOOTDBUSuPltHDvEEKx</a></p>
<p>AngularJS by default is a very test friendly framework. For someone who is eager to try functional programming, these days I am writing a lot of tiny private functions and I want to test them independently. Ofcourse this is not possible with the current Angular framework. To overcome this problem I tried a work around and this blog is about that.</p>
<p>Lets start with a simple example:</p>
<pre><code class="language-js">angular.module(&#39;app&#39;,[])
  .service(&#39;Service1&#39;,Service1);

function Service1(){
  this.getMessage = function(num1,num2){
    return &#39;The sum of the numbers is &#39;+sum(num1,num2);
  };
  function sum(num1, num2){
    return num1+num2;
  }
}
</code></pre>
<p>I am not interested to test <code>getMessage</code> . I only want to test <code>sum</code> as that is where all the logic happening. My unit test file looks like this:</p>
<pre><code class="language-js">describe(&#39;main tests&#39;,tests);
function tests(){
  var service;
  beforeEach(module(&#39;app&#39;));
  beforeEach(inject(function(Service1){
    service = Service1;
  }));

  it(&quot;should return the sum&quot;,function(){
    expect(service.sum(4,5)).toBe(9);
  });
}
</code></pre>
<p>I want to get this working. But it gives error.</p>
<p>To get this working, I added another service which always gives <code>false</code> for <code>testEnabled</code> value. In general case, we never touch it, but we will set it to <code>true</code> during testing. This way we can convert private functions to public during test and leave them private in general cases.</p>
<pre><code class="language-js">angular.module(&#39;app&#39;,[])
  .service(&#39;Service1&#39;,Service1)
  .service(&#39;Service2&#39;,Service2);

//Service2 code

function Service1(){
  this.getMessage = function(num1,num2){
    return &#39;The sum of the numbers is &#39;+sum(num1,num2);
  };
  function sum(num1, num2){
    return num1+num2;
  }

  if(Service2.testEnabled){
    this.sum = sum;
  }
}
</code></pre>
<p>Now we can continue with unit tests.</p>
<pre><code class="language-js">angular.module(&#39;app&#39;,[])
  .service(&#39;Service1&#39;,Service1)
  .service(&#39;Service2&#39;,Service2);


describe(&#39;main tests&#39;,tests);
function tests(){
  var service, service2;
  beforeEach(module(&#39;app&#39;));
  beforeEach(inject(function(Service2){
    service2 = Service2;
    service2.enableTest();
  }));
  beforeEach(inject(function(Service1){
    service = Service1;
  }));

  it(&quot;should return the name&quot;,function(){
    expect(service.sum(4,5)).toBe(9);
  });
}
</code></pre>
<p>Works great !!</p>
<p>The same can be used for private functions in Controllers too.</p></div><div data-href="http://vamshi.me/blog/test-private" data-numposts="5" class="fb-comments grey lighten-4 flow-text"></div></div></div></div><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-91419411-1', 'auto');
ga('send', 'pageview');</script><!--footer.page-footer.cyan.lighten-5.container
  .row
    .col.l6.s12
      h5.cyan-text Footer Content--></body></html>